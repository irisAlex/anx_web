/*! 
 Build based on gin-vue-admin 
 Time : 1713878256000 */
import{_ as e,a,o as l,c as t,b as o,d as i,w as u,K as s,L as r,g as p,f as d,t as n,j as m,$ as c,k as v,E as f,p as g,h as B}from"./087AC4D233B64EB0index.js";import{E as h}from"./087AC4D233B64EB0dialog.js";import"./087AC4D233B64EB0overlay.js";import{E as b}from"./087AC4D233B64EB0pagination.js";/* empty css                     */import"./087AC4D233B64EB0tag.js";import{E as C,a as y}from"./087AC4D233B64EB0select.js";import"./087AC4D233B64EB0scrollbar.js";/* empty css                      */import{E as A,a as E}from"./087AC4D233B64EB0table-column.js";import"./087AC4D233B64EB0checkbox.js";/* empty css                       */import{E as _}from"./087AC4D233B64EB0popover.js";import{a as D,E as j}from"./087AC4D233B64EB0form-item.js";/* empty css                      */import{g as V,d as w,f as k,a as x,u as U,c as I,b as G}from"./087AC4D233B64EB0api2.js";import{t as z}from"./087AC4D233B64EB0stringFun.js";import{_ as P}from"./087AC4D233B64EB0warningBar.js";import"./087AC4D233B64EB0isUndefined.js";import"./087AC4D233B64EB0isEqual.js";import"./087AC4D233B64EB0_Uint8Array.js";import"./087AC4D233B64EB0hasIn.js";import"./087AC4D233B64EB0index22.js";import"./087AC4D233B64EB0index23.js";import"./087AC4D233B64EB0strings.js";import"./087AC4D233B64EB0debounce.js";import"./087AC4D233B64EB0_initCloneObject.js";import"./087AC4D233B64EB0dropdown.js";import"./087AC4D233B64EB0castArray.js";import"./087AC4D233B64EB0_baseClone.js";/* empty css                     */const S=e=>(g("data-v-12fdb07c"),e=e(),B(),e),T={class:"gva-search-box"},q={class:"gva-table-box"},F={class:"gva-btn-list"},O=S((()=>o("p",null,"确定要删除吗？",-1))),K={style:{"text-align":"right","margin-top":"8px"}},L=S((()=>o("p",null,"确定要刷新Casbin缓存吗？",-1))),R={style:{"text-align":"right","margin-top":"8px"}},$={class:"gva-pagination"},H={class:"dialog-footer"},J=e(Object.assign({name:"Api"},{__name:"api",setup(e){const g=e=>{const a=J.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},B=a([]),S=a({path:"",apiGroup:"",method:"",description:""}),J=a([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),M=a(""),N=a({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),Q=a(1),W=a(0),X=a(10),Y=a([]),Z=a({}),ee=()=>{Z.value={}},ae=()=>{Q.value=1,X.value=10,ie()},le=e=>{X.value=e,ie()},te=e=>{Q.value=e,ie()},oe=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),Z.value.orderKey=z(e),Z.value.desc="descending"===a),ie()},ie=async()=>{const e=await V({page:Q.value,pageSize:X.value,...Z.value});0===e.code&&(Y.value=e.data.list,W.value=e.data.total,Q.value=e.data.page,X.value=e.data.pageSize)};ie();const ue=e=>{B.value=e},se=a(!1),re=async()=>{const e=B.value.map((e=>e.ID)),a=await w({ids:e});0===a.code&&(m({type:"success",message:a.msg}),Y.value.length===e.length&&Q.value>1&&Q.value--,se.value=!1,ie())},pe=a(!1),de=async()=>{const e=await k();0===e.code&&m({type:"success",message:e.msg}),pe.value=!1},ne=a(null),me=a("新增Api"),ce=a(!1),ve=e=>{switch(e){case"addApi":me.value="新增Api";break;case"edit":me.value="编辑Api"}M.value=e,ce.value=!0},fe=()=>{ne.value.resetFields(),S.value={path:"",apiGroup:"",method:"",description:""},ce.value=!1},ge=async()=>{ne.value.validate((async e=>{if(e)switch(M.value){case"addApi":0===(await I(S.value)).code&&m({type:"success",message:"添加成功",showClose:!0}),ie(),fe();break;case"edit":0===(await U(S.value)).code&&m({type:"success",message:"编辑成功",showClose:!0}),ie(),fe();break;default:m({type:"error",message:"未知操作",showClose:!0})}}))};return(e,a)=>{const V=v,w=D,k=C,U=y,I=f,z=j,M=_,Be=A,he=E,be=b,Ce=h;return l(),t("div",null,[o("div",T,[i(z,{ref:"searchForm",inline:!0,model:Z.value},{default:u((()=>[i(w,{label:"路径"},{default:u((()=>[i(V,{modelValue:Z.value.path,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),i(w,{label:"描述"},{default:u((()=>[i(V,{modelValue:Z.value.description,"onUpdate:modelValue":a[1]||(a[1]=e=>Z.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),i(w,{label:"API组"},{default:u((()=>[i(V,{modelValue:Z.value.apiGroup,"onUpdate:modelValue":a[2]||(a[2]=e=>Z.value.apiGroup=e),placeholder:"api组"},null,8,["modelValue"])])),_:1}),i(w,{label:"请求"},{default:u((()=>[i(U,{modelValue:Z.value.method,"onUpdate:modelValue":a[3]||(a[3]=e=>Z.value.method=e),clearable:"",placeholder:"请选择"},{default:u((()=>[(l(!0),t(s,null,r(J.value,(e=>(l(),p(k,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(w,null,{default:u((()=>[i(I,{type:"primary",icon:"search",onClick:ae},{default:u((()=>[d("查询")])),_:1}),i(I,{icon:"refresh",onClick:ee},{default:u((()=>[d("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),o("div",q,[o("div",F,[i(I,{type:"primary",icon:"plus",onClick:a[4]||(a[4]=e=>ve("addApi"))},{default:u((()=>[d("新增")])),_:1}),i(M,{modelValue:se.value,"onUpdate:modelValue":a[7]||(a[7]=e=>se.value=e),placement:"top",width:"160"},{reference:u((()=>[i(I,{icon:"delete",disabled:!B.value.length,onClick:a[6]||(a[6]=e=>se.value=!0)},{default:u((()=>[d("删除")])),_:1},8,["disabled"])])),default:u((()=>[O,o("div",K,[i(I,{type:"primary",link:"",onClick:a[5]||(a[5]=e=>se.value=!1)},{default:u((()=>[d("取消")])),_:1}),i(I,{type:"primary",onClick:re},{default:u((()=>[d("确定")])),_:1})])])),_:1},8,["modelValue"]),i(M,{modelValue:pe.value,"onUpdate:modelValue":a[10]||(a[10]=e=>pe.value=e),placement:"top",width:"160"},{reference:u((()=>[i(I,{icon:"Refresh",onClick:a[9]||(a[9]=e=>pe.value=!0)},{default:u((()=>[d("刷新缓存")])),_:1})])),default:u((()=>[L,o("div",R,[i(I,{type:"primary",link:"",onClick:a[8]||(a[8]=e=>pe.value=!1)},{default:u((()=>[d("取消")])),_:1}),i(I,{type:"primary",onClick:de},{default:u((()=>[d("确定")])),_:1})])])),_:1},8,["modelValue"])]),i(he,{data:Y.value,onSortChange:oe,onSelectionChange:ue},{default:u((()=>[i(Be,{type:"selection",width:"55"}),i(Be,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),i(Be,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),i(Be,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),i(Be,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),i(Be,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:u((e=>[o("div",null,n(e.row.method)+" / "+n(g(e.row.method)),1)])),_:1}),i(Be,{align:"left",fixed:"right",label:"操作",width:"200"},{default:u((e=>[i(I,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await x({id:e.ID});S.value=a.data.api,ve("edit")})(e.row)},{default:u((()=>[d("编辑")])),_:2},1032,["onClick"]),i(I,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{c.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await G(e)).code&&(m({type:"success",message:"删除成功!"}),1===Y.value.length&&Q.value>1&&Q.value--,ie())}))})(e.row)},{default:u((()=>[d("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),o("div",$,[i(be,{"current-page":Q.value,"page-size":X.value,"page-sizes":[10,30,50,100],total:W.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:te,onSizeChange:le},null,8,["current-page","page-size","total"])])]),i(Ce,{modelValue:ce.value,"onUpdate:modelValue":a[15]||(a[15]=e=>ce.value=e),"before-close":fe,title:me.value},{footer:u((()=>[o("div",H,[i(I,{onClick:fe},{default:u((()=>[d("取 消")])),_:1}),i(I,{type:"primary",onClick:ge},{default:u((()=>[d("确 定")])),_:1})])])),default:u((()=>[i(P,{title:"新增API，需要在角色管理内配置权限才可使用"}),i(z,{ref_key:"apiForm",ref:ne,model:S.value,rules:N.value,"label-width":"80px"},{default:u((()=>[i(w,{label:"路径",prop:"path"},{default:u((()=>[i(V,{modelValue:S.value.path,"onUpdate:modelValue":a[11]||(a[11]=e=>S.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),i(w,{label:"请求",prop:"method"},{default:u((()=>[i(U,{modelValue:S.value.method,"onUpdate:modelValue":a[12]||(a[12]=e=>S.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:u((()=>[(l(!0),t(s,null,r(J.value,(e=>(l(),p(k,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(w,{label:"api分组",prop:"apiGroup"},{default:u((()=>[i(V,{modelValue:S.value.apiGroup,"onUpdate:modelValue":a[13]||(a[13]=e=>S.value.apiGroup=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),i(w,{label:"api简介",prop:"description"},{default:u((()=>[i(V,{modelValue:S.value.description,"onUpdate:modelValue":a[14]||(a[14]=e=>S.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-12fdb07c"]]);export{J as default};
