/*! 
 Build based on gin-vue-admin 
 Time : 1713878256000 */
import{a,o as e,c as t,d as l,b as r,w as o,f as i,g as u,e as d,$ as s,j as n,E as m,k as p}from"./087AC4D233B64EB0index.js";import{E as h}from"./087AC4D233B64EB0drawer.js";import"./087AC4D233B64EB0overlay.js";import{E as y,a as v}from"./087AC4D233B64EB0tab-pane.js";import{E as c}from"./087AC4D233B64EB0dialog.js";import{a as B,E as f}from"./087AC4D233B64EB0form-item.js";/* empty css                     */import{E as C}from"./087AC4D233B64EB0radio.js";/* empty css                      */import"./087AC4D233B64EB0tag.js";import"./087AC4D233B64EB0checkbox.js";import"./087AC4D233B64EB0scrollbar.js";import{E as I,a as E}from"./087AC4D233B64EB0table-column.js";/* empty css                       *//* empty css                      */import{g as A,d as D,c as b,u as g,a as j}from"./087AC4D233B64EB0authority2.js";import w from"./087AC4D233B64EB0menus.js";import _ from"./087AC4D233B64EB0apis.js";import k from"./087AC4D233B64EB0datas.js";import{_ as N}from"./087AC4D233B64EB0warningBar.js";import"./087AC4D233B64EB0isUndefined.js";import"./087AC4D233B64EB0strings.js";import"./087AC4D233B64EB0castArray.js";import"./087AC4D233B64EB0_baseClone.js";import"./087AC4D233B64EB0_Uint8Array.js";import"./087AC4D233B64EB0_initCloneObject.js";import"./087AC4D233B64EB0index29.js";import"./087AC4D233B64EB0isEqual.js";import"./087AC4D233B64EB0arrays.js";import"./087AC4D233B64EB0cloneDeep.js";import"./087AC4D233B64EB0index22.js";import"./087AC4D233B64EB0index23.js";import"./087AC4D233B64EB0debounce.js";import"./087AC4D233B64EB0hasIn.js";import"./087AC4D233B64EB0tree.js";import"./087AC4D233B64EB0index27.js";import"./087AC4D233B64EB0authorityBtn.js";import"./087AC4D233B64EB0api2.js";/* empty css                     */const V={class:"authority"},x={class:"gva-table-box"},U={class:"gva-btn-list"},q={class:"dialog-footer"},S=Object.assign({name:"Authority"},{__name:"authority",setup(S){const z=a([{authorityId:0,authorityName:"根部门"}]),R=a(!1),F=a("add"),O=a({}),T=a("新增部门"),$=a(!1),P=a(!1),G=a({}),H=a({authorityId:0,authorityName:"",parentId:0}),J=a({authorityId:[{required:!0,message:"请输入部门ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入部门名",trigger:"blur"}],parentId:[{required:!0,message:"请选择上级部门",trigger:"blur"}]}),K=a(1),L=a(0),M=a(999),Q=a([]),W=a({}),X=async()=>{const a=await A({page:K.value,pageSize:M.value,...W.value});0===a.code&&(Q.value=a.data.list,L.value=a.data.total,K.value=a.data.page,M.value=a.data.pageSize)};X();const Y=(a,e)=>{O.value[a]=e},Z=a(null),aa=a(null),ea=a(null),ta=(a,e)=>{const t=[Z,aa,ea];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},la=a(null),ra=()=>{la.value&&la.value.resetFields(),H.value={authorityId:0,authorityName:"",parentId:0}},oa=()=>{ra(),$.value=!1,P.value=!1},ia=()=>{la.value.validate((async a=>{if(a){switch(H.value.authorityId=Number(H.value.authorityId),F.value){case"add":0===(await j(H.value)).code&&(n({type:"success",message:"添加成功!"}),X(),oa());break;case"edit":0===(await g(H.value)).code&&(n({type:"success",message:"添加成功!"}),X(),oa());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=H.value.authorityId,a.authority.authorityName=H.value.authorityName,a.authority.parentId=H.value.parentId,a.authority.dataAuthorityId=G.value.dataAuthorityId,a.oldAuthorityId=G.value.authorityId;0===(await b(a)).code&&(n({type:"success",message:"复制成功！"}),X())}}ra(),$.value=!1}}))},ua=()=>{z.value=[{authorityId:0,authorityName:"根部门"}],da(Q.value,z.value,!1)},da=(a,e,t)=>{H.value.authorityId=String(H.value.authorityId),a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===H.value.authorityId,children:[]};da(a.children,l.children,t||a.authorityId===H.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===H.value.authorityId};e.push(l)}}))};return(a,A)=>{const b=m,g=I,j=E,S=C,P=B,G=p,L=f,M=c,W=y,da=v,sa=h;return e(),t("div",V,[l(N,{title:"注：右上角头像下拉可切换部门"}),r("div",x,[r("div",U,[l(b,{type:"primary",icon:"plus",onClick:A[0]||(A[0]=a=>{return e=0,ra(),T.value="新增部门",F.value="add",H.value.parentId=e,ua(),void($.value=!0);var e})},{default:o((()=>[i("新增部门")])),_:1})]),l(j,{data:Q.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:o((()=>[l(g,{label:"部门ID","min-width":"180",prop:"authorityId"}),l(g,{align:"left",label:"部门名称","min-width":"180",prop:"authorityName"}),l(g,{align:"left",label:"操作",width:"460"},{default:o((a=>[l(b,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,R.value=!0,void(O.value=t);var t}},{default:o((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(b,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{ua(),T.value="编辑部门",F.value="edit";for(const e in H.value)H.value[e]=a[e];ua(),$.value=!0})(a.row)},{default:o((()=>[i("编辑")])),_:2},1032,["onClick"]),l(b,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void s.confirm("此操作将永久删除该部门, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await D({authorityId:t.authorityId})).code&&(n({type:"success",message:"删除成功!"}),1===Q.value.length&&K.value>1&&K.value--,X())})).catch((()=>{n({type:"info",message:"已取消删除"})}));var t}},{default:o((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(M,{modelValue:$.value,"onUpdate:modelValue":A[4]||(A[4]=a=>$.value=a),title:T.value},{footer:o((()=>[r("div",q,[l(b,{onClick:oa},{default:o((()=>[i("取 消")])),_:1}),l(b,{type:"primary",onClick:ia},{default:o((()=>[i("确 定")])),_:1})])])),default:o((()=>[l(L,{ref_key:"authorityForm",ref:la,model:H.value,rules:J.value,"label-width":"80px"},{default:o((()=>[l(P,{label:"上级部门",prop:"parentId"},{default:o((()=>[l(S,{modelValue:H.value.parentId,"onUpdate:modelValue":A[1]||(A[1]=a=>H.value.parentId=a),style:{width:"100%"},disabled:"add"===F.value,options:z.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(P,{label:"部门ID",prop:"authorityId"},{default:o((()=>[l(G,{modelValue:H.value.authorityId,"onUpdate:modelValue":A[2]||(A[2]=a=>H.value.authorityId=a),disabled:"edit"===F.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(P,{label:"部门姓名",prop:"authorityName"},{default:o((()=>[l(G,{modelValue:H.value.authorityName,"onUpdate:modelValue":A[3]||(A[3]=a=>H.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),R.value?(e(),u(sa,{key:0,modelValue:R.value,"onUpdate:modelValue":A[5]||(A[5]=a=>R.value=a),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"部门配置"},{default:o((()=>[l(da,{"before-leave":ta,type:"border-card"},{default:o((()=>[l(W,{label:"部门菜单"},{default:o((()=>[l(w,{ref_key:"menus",ref:Z,row:O.value,onChangeRow:Y},null,8,["row"])])),_:1}),l(W,{label:"部门api"},{default:o((()=>[l(_,{ref_key:"apis",ref:aa,row:O.value,onChangeRow:Y},null,8,["row"])])),_:1}),l(W,{label:"资源权限"},{default:o((()=>[l(k,{ref_key:"datas",ref:ea,authority:Q.value,row:O.value,onChangeRow:Y},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):d("",!0)])}}});export{S as default};
